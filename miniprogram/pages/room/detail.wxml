<wxs module="timeUtils" src="../../utils/timeUtils.wxs"></wxs>
<!--pages/room/detail.wxml-->
<view class="page">
  <view class="page__hd">
    <view class='weui-cell'>
      <view class='weui-cell__bd'>
        <view class="page__title">{{info.name}}</view>
        <view class="page__desc">{{info.description}}</view>
      </view>
      <view class="weui-cell__ft">
        <button class="weui-btn" size="mini" bindtap='change_history' wx:if="{{owner}}">
          <block wx:if="{{history_view}}">返回</block>
          <block wx:else>查看历史</block>
        </button>
        <button class="weui-btn" size="mini" bindtap='home' style="margin-left:10px" wx:if="{{show_home}}">返回首页</button>
      </view>
    </view>
  </view>
  <block wx:if="{{history_view}}">
  	<view class="weui-flex">
			<view class="weui-flex__item" style="text-align:right">
        <picker value="{{history_start}}" mode="date" bindchange="change_history_start" start="{{history_limit_start}}" end="{{history_end}}">
          <input class="weui-input" value="{{history_start}}" disabled="true"></input>
        </picker>
      </view>
      <view class="weui-flex__item" style="display: flex;justify-content: center;align-items: center;">至</view>
			<view class="weui-flex__item" style="text-align:left">
        <picker value="{{history_end}}" mode="date" bindchange="change_history_end" start="{{history_start}}" end="{{history_limit_end}}">
          <input class="weui-input" value="{{history_end}}" disabled="true"></input>
        </picker>
      </view>
		</view>
  </block>
  <date_select id="date_select" bindchange="date_select_change" wx:else></date_select>
  <view class="page_bd page__bd_spacing {{history_view?'':'body-with-footer'}}">
    <block wx:for="{{meetings}}" wx:key="id">
      <view class='meeting-item weui-form-preview' id="{{item.id}}" bindtap='detail'>
        <view class="weui-form-preview__hd">
          <view class="weui-form-preview__item">
            <view class="weui-form-preview__label">预定时间</view>
            <view class="weui-form-preview__value_in-hd">{{timeUtils.formatTime(item.start_time)}} - {{timeUtils.formatTime(item.end_time)}}</view>
          </view>
        </view>
        <view class="weui-form-preview__bd">
          <view class="weui-form-preview__item">
            <view class="weui-form-preview__label">名称</view>
            <view class="weui-form-preview__value">{{item.name}}</view>
          </view>
          <view class="weui-form-preview__item">
            <view class="weui-form-preview__label">描述</view>
            <view class="weui-form-preview__value">{{item.description}}</view>
          </view>
        </view>
      </view>
    </block>
  </view>
  
  <view class="weui-footer footer" wx:if="{{!history_view}}">
    <view class="weui-flex">
      <view class="weui-flex__item">
        <button size="mini" open-type="share">分享</button>
      </view>
      <view class="weui-flex__item">
        <button size="mini" bindtap='reserve'>预约</button>
      </view>
      <view class="weui-flex__item">
        <button size="mini" bindtap='unfollow' wx:if="{{info.is_follow}}">取消关注</button>
        <button size="mini" bindtap='follow' wx:else>关注</button>
      </view>
      <view class="weui-flex__item" vx:if="{{info.qr_code}}">
        <button size="mini" bindtap='show_qrcode'>二维码</button>
      </view>
      <block wx:if="{{owner}}">
        <view class="weui-flex__item">
          <button size="mini" bindtap='edit'>修改</button>
        </view>
        <view class="weui-flex__item">
          <button size="mini" bindtap='del'>删除</button>
        </view>
      </block>
    </view>
  </view>
  
</view>

<modal class="modal" hidden="{{!show_qr_code}}" no-cancel bindconfirm="hide_qrcode" confirmText="确定" title="{{info.name}} 专属二维码">
  <view class="dew">  
    <image class="qr_code" src="{{info.qr_code}}" mode="aspectFit" show-menu-by-longpress></image>
    <view class="vedw">长按二维码可保存到相册</view>   
  </view>
</modal>